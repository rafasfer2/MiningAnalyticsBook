---
format: html
---

# Ciclo de Perfuração e Desmonte de Rocha (Drilling and Blasting Cycle) {#chap-perfuracao}

```{r setup, include=FALSE}
#| message: false
#| warning: false
# Este bloco SEMPRE executa para carregar as ferramentas necessárias
library(tidyverse)
library(miningKPI)
library(knitr)
library(lubridate)
```

## Fundamentos Técnicos e Geométricos

### Tecnologias e Métodos de Perfuração

A escolha do método impacta diretamente as variáveis de tempo de perfuração ($D_i$) e manuseio de hastes ($H_i$) que, por consequência, influencia na taxa de penetração líquida **(Rate of Penetration - ROP)**.

#### Top Hammer (Martelo de Topo):

Indicado para furos de diâmetros menores (\< 140 mm). A energia de impacto é produzida no mastro e transmitida via coluna de hastes.

-   **Mecanismo:** A potência de percussão é o produto da energia de impacto pela frequência.

-   **Vantagem:** Alto ROP em rochas rasas e sólidas.

-   **Desvantagem:** Perda de energia (\~5%) em cada junta de haste.

#### Down The Hole (DTH - Martelo de Fundo):

O martelo atua no fundo do furo, logo acima do bit.

-   **Vantagem:** Mantém o ROP constante em furos profundos e garante maior precisão (menor desvio).

-   **Desvantagem:** Exige maior suporte para afiação de bits e diâmetros mínimos elevados.

#### Método Híbrido (Perfuração Rotativa Assistida por Percussão):

Utiliza martelo de impacto baixo com pistão leve de curso curto, gerando alta frequência.

-   **Vantagem:** Elevadas taxas de ROP e emboquilhamentos ($C_i$) mais precisos.

-   **Desvantagem:** Alto custo de manutenção e aquisição.

![Top Hammer vs Down-The-Hole.](../images/fig-metodo-perfura-gimini.jpg){#fig-metodo_perfuracao}

### Parâmetros Geométricos da Bancada

O dimensionamento correto do plano de fogo depende do equilíbrio entre diversas variáveis geométricas. A \@fig-parametros-bancada ilustra os principais parâmetros que definem como a energia do explosivo será distribuída na massa rochosa:

#### Afastamento (Burden - $B$):

É a distância perpendicular da linha de furos até a face livre da bancada, ou a distância entre linhas de furos consecutivas.

-   *Impacto:* É o parâmetro mais crítico. Um burden excessivo confina a energia, gerando repé (piso alto) e vibração excessiva. Um burden muito curto causa lançamento perigoso de material (*flyrock*) e ruído.

#### Espaçamento (Spacing - $S$):

É a distância lateral entre furos de uma mesma linha.

-   *Impacto:* Define a interação das ondas de choque entre furos adjacentes. Se excessivo, resulta em fragmentação grosseira (matacões) entre os furos.

#### Diâmetro do Furo (Hole Diameter - $d$):

Dimensão transversal do furo, definida pelo diâmetro da broca/bit utilizado.

-   *Impacto:* Determina a concentração de carga por metro perfurado. Diâmetros maiores permitem maior produção por furo, mas exigem malhas mais abertas e aumentam o risco de vibração.

#### Altura da Bancada (Bench Height - $H$):

Distância vertical entre o pé (piso inferior) e a crista (nível superior) da bancada.

-   *Impacto:* Deve ser dimensionada para ser compatível com o alcance máximo do equipamento de carga (escavadeira), garantindo segurança e produtividade na escavação.

#### Sobreperfuração (Subdrilling - $J$):

Comprimento adicional perfurado abaixo da cota do pé da bancada.

-   *Impacto:* Essencial para garantir que a quebra da rocha atinja o nível do piso, evitando a formação de repés que prejudicam o tráfego de equipamentos e a eficiência da carga.

#### Tampão (Stemming -\*\* $T$):

A porção superior do furo preenchida com material inerte (geralmente brita ou detritos de perfuração) em vez de explosivo.

-   *Impacto:* Confina os gases da detonação dentro do furo para maximizar o trabalho útil de fragmentação e impede o escape prematuro de energia pela boca do furo.

![Parâmetros geométricos fundamentais para o dimensionamento do desmonte de rochas.](/images/fig-parametros-bancada-gimini.jpg)

### Tipos de Malhas de Perfuração

A disposição geométrica dos furos na bancada define o que chamamos de malha de perfuração. Essa configuração é determinante para a distribuição da energia dos explosivos e impacta diretamente tanto o tempo de deslocação ($M_i$) quanto a granulometria resultante do desmonte.

#### **Malha Quadrada (Square Pattern)**

Nesta configuração, o espaçamento (\$S\$) é rigorosamente igual ao afastamento (\$B\$), resultando na relação \$S = B\$.

-   **Característica Operacional:** É a malha que mais facilita a logística de manobra da perfuratriz. Como a distância entre os pontos é constante em todas as direções, o tempo gasto em deslocação ($M_i$) é minimizado.

-   **Aplicação:** Ideal para áreas onde a facilidade de navegação do ativo é prioritária em relação à distribuição ultra-homogênea de energia.

#### **Malha Retangular (Rectangular Pattern)**

Neste arranjo, os furos de linhas adjacentes mantêm o mesmo alinhamento, porém o espaçamento é maior que o afastamento ($S > B$).

-   **Característica Operacional:** Assim como na malha quadrada, permite uma perfuração rápida e manobras lineares simples.

-   **Ponto de Atenção:** Devido à geometria, existe uma zona central entre quatro furos com menor influência de energia do explosivo, o que pode ocasionar a formação de matacões (blocos grandes) no núcleo da malha, prejudicando a produtividade da escavadeira no carregamento.

#### **Malha Estagiada (Staggered Pattern)**

Também conhecida como "pé de galinha", caracteriza-se pelo desalinhamento entre as linhas: os furos da linha subsequente são posicionados na direção da metade do espaçamento da linha frontal, mantendo geralmente $S > B$.

-   **Vantagem Técnica:** Oferece uma distribuição de energia superior às malhas quadradas e retangulares, resultando em uma fragmentação de rocha muito mais homogênea.

-   **Desvantagem Operacional:** Exige manobras mais complexas da perfuratriz (zigue-zague ou diagonais), o que eleva o tempo de deslocamento ($M_i$) e exige maior perícia do operador.

#### **Malha Estagiada Triângulo Equilátero**

Uma variação da malha estagiada onde a distância entre quaisquer três furos adjacentes é igual, formando triângulos equiláteros perfeitos.

-   **Característica Técnica:** Oferece a distribuição de energia mais uniforme possível, sendo ideal para rochas de difícil fragmentação (como o **Jaspelito**).

-   **Exigência:** Requer altíssima precisão na marcação topográfica (*Survey Stakeout*) ou o uso de HPGPS de alta fidelidade, pois pequenos desvios de posicionamento anulam os benefícios dessa geometria.

![Representação esquemática das malhas de perfuração.](../images/fig-tipos-malha-gimini.jpg){#fig-tipos-malha}

### Ferramentas de Perfuração

As perfuratrizes (*drill rigs*) são os equipamentos centrais na etapa de fragmentação primária (*primary fragmentation*), mas sua eficiência depende diretamente dos materiais de extensão (*extension materials*) e acessórios que compõem a coluna de perfuração (*drill string*). Esses acessórios são as ferramentas ligadas à coluna nas quais a energia é aplicada e distribuída para a rocha, viabilizando a execução dos furos.

Entre os componentes mais críticos para a performance, destacam-se o **Bit DTH** e as hastes (*drill rods*). A escolha dessas ferramentas não é arbitrária; ela deve ser orientada pelo diâmetro do furo almejado e, principalmente, pelas características geomecânicas do solo e da rocha.

#### Geometria de Face dos Bits (*Bit Face Geometry*)

A face do *bit* é a interface direta de transferência de energia. Como ilustrado na \@fig-faces-bits, existem quatro geometrias principais identificadas por siglas técnicas para diferentes condições de terreno:

-   **Face Côncava (*Concave Face* - CC):** Especialmente indicada para formações de média dureza. Sua geometria auxilia na estabilidade do furo e possibilita perfurações de grandes diâmetros com bom alinhamento (*hole alignment*).

-   **Face Convexa (*Convex Face* - CV):** Projetada para enfrentar rochas duras e abrasivas. O diâmetro da perfuração é mantido por duas fileiras de botões na coroa, o que aumenta a resistência ao desgaste lateral.

-   **Face Plana (*Flat Face* - FT):** É a escolha técnica para perfurações em terrenos fraturados ou instáveis, onde a integridade das paredes do furo é um desafio.

-   **Uniface (UF):** Recomendável para as condições mais severas de rochas muito duras e altamente abrasivas, onde a durabilidade do acessório é testada ao limite.

![Tipos de Faces de Bits para perfuração DTH.](/images/fig-faces-bits.jpg){#fig-faces-bits}

#### Hastes de Perfuração (*Drill Rods*)

As hastes de perfuração (*drill rods*) são as ferramentas percussivas que compõem a coluna de perfuração (*drill string*) e permitem que o furo atinja a profundidade de projeto (*target depth*). Para garantir a excelência operacional e a integridade do ativo, dois fatores são essenciais:

-   **Compatibilidade (*Machine Compatibility*):** O comprimento e o peso da haste devem ser estritamente compatíveis com o porte do mastro e o torque (*torque capacity*) da perfuratriz.

-   **Estado de Conservação (*Maintenance Condition*):** Acessórios empenados ou com perfis de rosca (*thread profiles*) desgastados — tanto na conexão macho (*pin*) quanto na fêmea (*box*) — geram vibração excessiva, desvios de furo (*hole deviation*) e perda de energia de impacto. Isso resulta na degradação direta da Taxa de Penetração ($ROP$).

![Detalhe de uma haste de perfuração e suas conexões.](../images/fig-haste-perfuracao.jpg){#fig-haste-perfuracao}

#### Desgaste das Ferramentas e Impacto nos KPIs

A análise de performance no **Mining Analytics** deve considerar rigorosamente o ciclo de vida dos acessórios. Existe uma correlação física direta entre o estado de afiação dos botões de metal duro (*carbide buttons*) do **Bit DTH** e a eficácia da fratura da rocha.

::: {.callout-note title="Insight Técnico: Sharp vs. Dull Bits"}
Quando o bit está devidamente afiado, a transferência de energia percussiva é máxima, resultando em uma Taxa de Penetração (\$ROP\$) otimizada. Conforme os botões sofrem desgaste (perda de projeção), o bit torna-se menos eficaz, exigindo maior pressão de avanço (pull-down) e gerando dissipação de energia em forma de calor em vez de fragmentação mecânica.
:::

O monitoramento sistemático do desgaste é crucial por três pilares de gestão:

1.  **Produtividade (*Productivity*):** *Bits* "cegos" ou desgastados reduzem drasticamente a metragem perfurada por hora, o que impacta o indicador global de **GDR** (*Gross Drilling Rate*).

2.  **Custo Operacional (*Operating Cost*):** O uso prolongado de ferramentas desgastadas aumenta o custo por metro perfurado e reduz a vida útil de outros componentes da perfuratriz devido à vibração refletida (*vibration feedback*).

3.  **Manutenção Preventiva (*Preventive Maintenance*):** A identificação do momento exato para a troca ou reafiação (*regrinding*) evita paradas não planejadas e incidentes críticos, como a quebra de hastes e perda de ferramentas dentro do furo (*lost-in-hole*).

### Estudo de Caso: Controle de Matacões e Otimização de Malha

Em um determinado circuito do processo de lavra, a equipe de engenharia identificou uma elevada incidência de blocos do tipo "Matacão/Lamelar". A premissa de processamento estabelece limites de entrada de material com até **1200 mm (*top size*)**, sendo que fragmentos acima desta dimensão são classificados como matacões, enquanto o produto desejável deve situar-se na faixa de até 300 mm.

**Impacto nos KPIs:**

As paradas operacionais para a realização de "recaque" (secondary breakage) e a retirada física de blocos acima do top size são contabilizadas como Horas Ociosas Internas (HOI). Esse gargalo impacta diretamente a Utilização Física (UF) do equipamento de carga e, consequentemente, o cumprimento das metas globais de produção.

Após a investigação das causas raiz, priorizou-se a alternância da malha de perfuração em áreas com corpos de material compacto (como o Jaspelito) não mapeados pelo modelo de blocos original. Duas soluções técnicas foram implementadas:

#### Adensamento da Malha (*Pattern Densification*)

A estratégia consistiu na redução da área da malha de desmonte de **33** $m^2$ para 22 $m^2$. O foco principal foi a redução da fragmentação grossa, mantendo o custo e o fator de carga equilibrados pela compensação do volume.

A @fig-malha-perfuracao ilustra a sobreposição do plano de perfuração (pontos brancos) com as áreas geológicas de material compacto (manchas azuis). Nota-se a transição operacional: na região à direita, a malha seguia o padrão de 33 $m^2$, enquanto na região central e esquerda, onde a dureza da rocha é superior, aplicou-se o adensamento para 22 $m^2$.

![Plano de fogo com a necessidade de adensamento devido ao aumento da área compacta.](/images/fig-malha-perfura-gimini.jpg){#fig-malha-perfuracao}

#### Redução de Tampão (*Stemming Reduction*)

A segunda frente de atuação foi a redução do tampão de **4,0 m para 3,6 m** em áreas de material compacto, visando minimizar a energia retida no colar do furo e reduzir a incidência de blocos na crista da bancada.

Conforme detalhado na @fig-reducao-tampao-perfuracao , o plano de desmonte foi subdividido:

-   **Zonas de Tampão:** A redução para 3,6 m (indicada pela área tracejada) foca na fragmentação da parte superior do furo.

-   **Carga de Explosivos:** Ajustada entre 305 kg e 320 kg por furo para otimizar a quebra da rocha sem exceder os limites de vibração.

A redução do *top size* alimentado no circuito aumenta a eficiência de carregamento e protege a integridade física da frota de transporte.

![Tampão em área de material compactado.](../images/fig-reducao-tampao-perfura-gimini.jpg){#fig-reducao-tampao-perfuracao}

#### Validação via Análise Granulométrica Digital

Para validar a eficácia das ações de adensamento e redução de tampão, utilizou-se a análise digital de imagem. A sequência apresentada na @fig-sequencia-analise-granulometrica detalha o rigor técnico necessário para monitorar a face da bancada:

1.  **Registro da Imagem (*Sample Image*):** Captura fotográfica da face com o uso de um gabarito de escala (esferas vermelhas) para calibração métrica do sistema.

2.  **Delineamento Automático (*Display Delineations*):** Aplicação de algoritmos para segmentação e contorno individual de cada fragmento de rocha exposto.

3.  **Refino e Edição Manual:** Ajuste crítico realizado pelo analista para unificar blocos que o algoritmo fragmentou erroneamente de forma digital. Este passo é vital para que o cálculo da curva granulométrica reflita a realidade física do material e identifique corretamente a presença de matacões.

![Sequência de análise granulométrica.](../images/fig-sequencia-analise-granulo-gimini.jpg){#fig-sequencia-analise-granulometrica}

## O Ciclo Físico de Perfuração (Drilling Cycle)

O ciclo operacional de uma perfuratriz não se resume apenas a "furar o chão". Para fins de análise, a @fig-ciclo-perfuracao mostra o ciclo composto por cinco fases fundamentais que devem ser monitoradas individualmente:

1.  **Posicionamento (Positioning -** $P_i$): Alinhamento da máquina de acordo com as coordenadas do furo e nivelamento das sapatas (*jacks*).

2.  **Emboquilhamento (Collaring -** $C_i$): Início da penetração cuidadosa (baixa rotação/avanço) para evitar desvios iniciais e garantir a integridade da "boca" do furo.

3.  **Perfuração (Drilling -** $D_i$): Aplicação de rotação, percussão e *pull-down* pleno para o avanço na rocha.

4.  **Manuseio de Hastes (Rod Handling -** $H_i$): Adição sucessiva de hastes para profundidade ou sua retirada (*threading/unthreading*).

5.  **Deslocação (Tramming -** $M_i$): Movimentação para o próximo ponto de furo dentro da mesma malha.

![Ciclo de Perfuração.](/images/fig-ciclo-perfuracao-gimini.png){#fig-ciclo-perfuracao}

### Análise de Dados com `miningKPI`

No pacote `miningKPI`, traduzimos esses eventos físicos em estruturas de dados para análise de performance.

::: {#exm-dados-eventos-perfuracao}
## Dados de eventos de perfuração – Mina D

Disponibilizamos o banco de dados `drill_events_mine_d`. Este dataset contém a telemetria detalhada (formato *long*), permitindo identificar cada fase da Identidade Fundamental. Note que, na prática, os dados brutos podem apresentar falhas de registro (fases ausentes) ou repetições.
:::

```{r}
#| echo: true
#| message: false

# Exemplo de dois ciclos da perfuratriz DRILL_100
drill_events_mine_d %>%
    filter(drill_id == "DRILL_100", cycle %in% 1:2) %>%
    kable(caption = "Sequência de eventos brutos da DRILL_100")
```

#### Analisando a sequência cronológica

Ao observar os dados da **DRILL_100**, podemos extrair *insights* valiosos sobre a eficiência da operação:

-   **Fases 1 e 2 (**$P_i$ e $C_i$): Representam os preparativos. Se o operador gasta muito tempo na **Fase 1 (Posicionamento)**, a praça pode estar mal nivelada ou o layout da malha está dificultando a manobra.

-   **Fase 3 (**$D_i$): É aqui que a Taxa de Penetração (ROP) é calculada. Em furos profundos, é comum vermos a **Fase 3** e a **Fase 4 (**$H_i$) se repetirem alternadamente conforme novas hastes são adicionadas.

-   **Fase 5 (**$M_i$): Marca o encerramento do furo atual e o deslocamento para o próximo ponto da malha.

A repetição das fases 3 e 4, característica de furos que exigem múltiplas hastes, pode ser observada detalhadamente no **Ciclo 2**:

#### **Detalhamento do Ciclo 2 (**$X_2$)

-   **Phase 1:** Zero eventos registrados $\rightarrow P_2 = 0,00$ minutos.

-   **Phase 2:** Zero eventos registrados $\rightarrow C_2 = 0,00$ minutos.

-   **Phase 3 (Perfuração):** Composta por 3 eventos $\rightarrow D_2 = 6,87 + 3,38 + 5,60 = 15,85$ minutos.

-   **Phase 4 (Hastes):** Composta por 3 eventos $\rightarrow H_2 = 9,38 + 5,72 + 2,22 = 17,32$ minutos.

-   **Phase 5 (Deslocamento):** Composta por 1 evento $\rightarrow M_2 = 1,62$ minutos.

### Consolidação e Higienização com `add_missing_drill_phases()`

Para que a análise estatística seja robusta, utilizamos a função `add_missing_drill_phases()`. Ela identifica fases ausentes e as imputa com duração zero, garantindo que cada ciclo contenha as 5 fases fundamentais, além da Fase 6 (`exit_cycle`), um marcador técnico necessário para o motor de cálculo.

::: {#exm-fases-faltantes}
## Análise de input das fases faltantes

Como o `drill_events_mine_d` é um objeto de eventos brutos, aplicamos a função para observar o preenchimento das lacunas:
:::

```{r}
#| echo: true
#| message: false

# Agora as funções são encontradas pois carregamos miningKPI no setup
drill_events_mine_d %>%
    filter(drill_id %in% "DRILL_100", cycle %in% 1:2) %>%
    add_missing_drill_phases() %>%
    knitr::kable(caption = "Detalhamento de eventos com fases imputadas (DRILL_100)")
```

Note que os seguintes eventos foram gerados automaticamente pelo algoritmo:

-   **No Ciclo 1:** Imputação da **Phase 1** (linha 1) e da **Phase 6** (linha 8).

-   **No Ciclo 2:** Imputação da **Phase 1** (linha 9), **Phase 2** (linha 10) e da **Phase 6** (linha 19).

### Identidade Fundamental do Ciclo de Perfuração

A base de toda análise de eficiência em perfuração parte da premissa de que o tempo total para completar um furo ($X_i$) é a soma linear de seus componentes excludentes:

$$X_i = P_i + C_i + D_i + H_i + M_i$$

Esta igualdade permite identificar a natureza dos gargalos operacionais:

-   **Elevação de** $D_i$: Provável causa geológica (rocha dura) ou desgaste excessivo do *bit*.

-   **Elevação de** $H_i$: Problemas mecânicos no carrossel de hastes ou inexperiência operacional no manuseio.

-   **Elevação de** $M_i$: Problemas de infraestrutura (praça mal preparada) ou layout de malha ineficiente.

Utilizamos o agrupamento por ciclo para consolidar os tempos e validar a identidade fundamental:

::: {#exm-identidade-fundamental}
## Calculando a identidade fundamental do ciclo de perfuração

Utilizamos o agrupamento por ciclo para consolidar os tempos e validar a identidade fundamental:
:::

```{r}
#| echo: true
#| message: false

drill_events_mine_d %>%
    filter(drill_id %in% "DRILL_100", cycle %in% 1:3) %>%
    add_missing_drill_phases() %>%
    group_by(drill_id, cycle) %>%
    summarise(
        start_hole = min(first_time, na.rm = TRUE),
        total_xi_min = sum(duration_min, na.rm = TRUE),
        pi_sum = sum(duration_min[!is.na(phase) & phase == 1], na.rm = TRUE),
        ci_sum = sum(duration_min[!is.na(phase) & phase == 2], na.rm = TRUE),
        di_sum = sum(duration_min[!is.na(phase) & phase == 3], na.rm = TRUE),
        hi_sum = sum(duration_min[!is.na(phase) & phase == 4], na.rm = TRUE),
        mi_sum = sum(duration_min[!is.na(phase) & phase == 5], na.rm = TRUE),
        xi_sum = pi_sum + ci_sum + di_sum + hi_sum + mi_sum,
        .groups = "drop"
    )
```

#### Interpretando os Gaps Operacionais

Ao confrontarmos o `total_xi_min` (tempo total de residência) com o `xi_sum` (soma das fases produtivas), identificamos o que chamamos de **Gaps Operacionais**. Esses intervalos são cruciais para a gestão, pois revelam tempos em que o equipamento está disponível e alocado, mas não está perfurando.

Observe a investigação realizada nos ciclos da **DRILL_100**:

```{r}
#| echo: true
#| message: false

drill_events_mine_d %>%
    filter(drill_id %in% "DRILL_100", cycle %in% 1:3, is.na(phase)) %>%
    select(drill_id, borehole_uid, cycle, category, description, duration_min)
```

#### Análise de Causa Raiz

1.  **Ciclo 1 (Ociosidade Crítica):** Diferença de \~47 minutos. O tempo foi consumido por:

    -   *Shift Change (1.13 min):* Troca de turno rápida.

    -   *Operator Talk/Lecture (45.6 min):* Palestra operacional.

    -   **Insight:** O baixo rendimento não foi mecânico ou geológico, mas uma decisão de gestão (treinamento).

2.  **Ciclo 2 (Atraso Logístico):** Evento de *Water Refill (9.23 min)*. Necessário, mas se excessivo indica falha na logística do caminhão-pipa.

3.  **Ciclo 3 (Performance Ideal):** Aderência total. É o "ciclo limpo", operando do posicionamento ao deslocamento sem interrupções.

::: {.callout-tip title="Nota de Modelagem"}
Diferente do carregamento, onde a carga varia, na perfuração a profundidade é fixa por projeto. O uso da higienização garante que a média de $C_i$ (Emboquilhamento), por exemplo, não seja enviesada por ciclos onde o sensor falhou em registrar o evento.
:::

### Do Planejamento à Marcação de Campo

A execução da perfuração não é um evento isolado, mas o resultado de um fluxo de planejamento rigoroso. No pacote `miningKPI`, podemos rastrear as falhas nesse fluxo através das descrições operacionais (`description_en`) e categorias de ociosidade interna (HOI/IIH).

1.  **Dimensionamento do Plano:** Os polígonos de perfuração são desenhados em softwares de engenharia, definindo coordenadas $(x,y,z)$, *burdens* (afastamento) e espaçamentos (*spacing*).

    ::: {.callout-note appearance="simple" icon="false"}
    **Evidência nos Dados:** Quando o plano não chega à cabine, observamos a descrição `"Waiting for Planning Demand"` ou comentários como `"Missing Polygon/Pattern"`. Sem o polígono digital, a perfuratriz fica impossibilitada de operar com HPGPS.
    :::

2.  **Preparação da Área (Pad Preparation):** Liberação de ordens para tratores de esteira (*Dozers*) limparem e nivelarem a praça. Uma praça mal preparada aumenta drasticamente o tempo de Posicionamento ($P_i$).

    ::: {.callout-note appearance="simple" icon="false"}
    **Evidência nos Dados:** Este gargalo é identificado pelas descrições `"Waiting for Pad Adjustment"` e `"Waiting for Access Condition"`. Na prática, se o tempo acumulado nessas categorias for alto, a oportunidade de melhoria não está na perfuratriz, mas na frota de apoio (infraestrutura).
    :::

3.  **Marcação Topográfica (Survey Stakeout):** É a materialização física (piquetes) ou via GPS de alta precisão (HPGPS) do local exato onde o operador inicia o ciclo.

    ::: {.callout-note appearance="simple" icon="false"}
    **Evidência nos Dados:** Falhas nesta etapa geram descrições como `"Waiting for Survey"` e `"Waiting for Drill Pattern Mark."`. O comentário `"Project Not Updating / No Physical Marking"` é o exemplo clássico de um erro de redundância: o sistema digital falhou e a marcação física (tradicional) não foi realizada, paralisando o ativo.
    :::

#### Resumo de Correlação para Investigação

Para facilitar a análise de causa raiz, a tabela abaixo correlaciona as etapas do planejamento com os dados que você encontrará no dataset:

| Planning Stage (Etapa de Planejamento) | Technical Initials (Sigla Técnica) | KPI Category (PT / EN) | Common Descriptions (Descrições Comuns) |
|:-----------------|:-----------------|:-----------------|:-----------------|
| **Dimensioning (Design)** | Plano / Plan | HOI / IIH | `Waiting for Planning Demand`, `Missing Polygon` |
| **Preparation (Pad Prep)** | Infra | HOI / IIH \| HTD / DWH | `Waiting for Pad Adjustment`, `Access Condition` |
| **Marking (Survey)** | Topo / Survey | HOI / IIH \| HTI / IWH | `Waiting for Survey`, `Pattern Marking` |

::: {#exm-falhas-planejamento}
## Investigando Falhas no Fluxo de Planejamento

Abaixo, demonstramos como utilizar os dados de telemetria para identificar qual etapa do planejamento — Design (*Plan*), *Pad Preparation* ou *Survey Stakeout* — está impactando a disponibilidade física da frota. Neste exemplo, filtramos apenas os eventos que não possuem fase produtiva (`is.na(phase)`) e os categorizamos utilizando as descrições e comentários traduzidos.
:::

```{r}
#| echo: true
#| message: false

# 1. Agregação robusta: KPIs + Percentuais de Fase
performance_report <- drill_events_mine_d %>%
    filter(drill_id == "DRILL_100") %>%
    mutate(periodo = as.Date(exit_time)) %>%
    group_by(drill_id, periodo) %>%
    summarise(
        TDM = sum(allocated_meters, na.rm = TRUE),
        WH = sum(duration_min, na.rm = TRUE) / 60,
        HEF = sum(duration_min[category == "HEF"], na.rm = TRUE) / 60,
        ROP = ifelse(HEF > 0, TDM / HEF, 0),
        GDR = ifelse(WH > 0, TDM / WH, 0),
        total_min = sum(duration_min, na.rm = TRUE),
        n_holes = n_distinct(borehole_uid),
        .groups = "drop"
    )

# 2. Exibição dos indicadores
performance_report %>%
    select(drill_id, periodo, TDM, WH, ROP, GDR, n_holes) %>%
    head(5) %>%
    kable(digits = 2, caption = "Indicadores de Performance")
```

**Análise de Causa Raiz para o Gestor:**

A inclusão da `category` e da `description_en` permite uma auditoria precisa sobre qual processo está retendo o ativo:

1.  **Design (Plan):** Se observarmos altos tempos com categoria HOI (Horas Ociosas Internas) nesta etapa, a engenharia de curto prazo está falhando na entrega dos polígonos digitais, impedindo o uso do HPGPS.

2.  **Pad Preparation:** Eventos de infraestrutura que impactam o posicionamento ($P_i$). Se o tempo de *Pad Adjustment* for crítico, a frota de apoio (tratores) deve ser cobrada por não preparar as frentes a tempo.

3.  **Survey Stakeout:** Representa a falha de marcação física. Quando a telemetria registra *Waiting for Survey*, o operador está paralisado aguardando a topografia, o que degrada diretamente o GDR (*Gross Drilling Rate*).

## Mensuração da Performance (KPIs)

A transformação dos registros brutos de telemetria em inteligência de negócio é processada de forma automatizada pelas funções do pacote `miningKPI`. No contexto do *Mining Analytics*, a análise de performance na perfuração transcende a simples métrica de volume ("o quanto foi furado"). O objetivo central é decifrar a **eficiência da interação máquina-rocha** (desempenho mecânico) em contraste com a **eficiência do processo operacional** (gestão de fluxos e tempos).

### Estrutura de Dados e Notações Fundamentais

Para viabilizar a modelagem estatística e a análise de excelência operacional, traduzimos os eventos físicos capturados pelos sensores em variáveis matemáticas padronizadas. Essa estrutura facilita a identificação de gargalos e permite que o motor de cálculo do pacote reconheça cada transição de estado da perfuratriz.

A @tbl-notacao-perfuracao apresenta o mapeamento das fases operacionais utilizadas ao longo deste capítulo:

|  |  |  |  |
|------------------|------------------|------------------|------------------|
| **Fase Operacional** | **Notação no Livro** | **ID no Script (phase)** | **Termo em Inglês** |
| Posicionamento | $P_i$ | **1** | Positioning |
| Emboquilhamento | $C_i$ | **2** | Collaring |
| Perfuração | $D_i$ | **3** | Drilling |
| Manuseio de Hastes | $H_i$ | **4** | Rod Handling |
| Deslocação (Tramming) | $M_i$ | **5** | Tramming |
| Fim de Ciclo (Técnico) | $X_i$ | **6** | Exit Cycle / Total |

: Relação entre fases operacionais e notações na perfuração. \[\^1\] {#tbl-notacao-perfuracao}

Para converter as observações físicas em indicadores de performance (KPIs), padronizamos as métricas conforme a @tbl-metricas-perfuracao. Esta estrutura permite uma transição fluida entre a teoria de engenharia de minas e a implementação computacional.

|                              |             |                     |               |
|------------------------|----------------|-----------------|----------------|
| **Parâmetro de Performance** | **Notação** | **Variável no R**   | **Unidade**   |
| Metragem Total Perfurada     | **TDM**     | `allocated_meters`  | metros (m)    |
| Tempo de Ciclo Total         | $X_i$       | `xi_min`            | minutos (min) |
| Taxa de Penetração Líquida   | **ROP**     | Calculado (TDM/EFH) | m/h           |
| Taxa de Perfuração Bruta     | **GDR**     | Calculado (TDM/Xi)  | m/h           |

: Definições de métricas e variáveis para análise de performance. {#tbl-metricas-perfuracao}

### Metragem Total Perfurada (Total Drilled Meters - TDM)

Representa o volume físico total de furos realizados em um intervalo de tempo $t$. É o indicador de entrega bruta da frota.

$$TDM = \sum_{i=1}^{N(t)} L_i$$

-   $L_i$: Profundidade líquida do furo $i$ (m).

-   $N(t)$: Número total de furos acumulados no período.

> **Exemplo Prático:** Se a perfuratriz DRILL_100 executou 20 furos em um turno, cada um com 15 metros de profundidade, o TDM será de 300 metros. Se houver sobre-perfuração (*sub-drilling*) para garantir a quebra do pé da bancada, esses metros adicionais também devem ser contabilizados no $L_i$.

### Taxa de Penetração Líquida (Rate of Penetration - ROP)

Mede a velocidade média de avanço da ferramenta exclusivamente durante o tempo de contato e corte da rocha ($D_i$). É o indicador puro de **eficiência mecânica** e resposta litológica.

$$ROP = \frac{TDM}{\sum_{i=1}^{N(t)} D_i} \quad [m/h]$$

-   $ROP$: Taxa de Penetração Líquida (m/h).

-   $D_i$: Tempo de perfuração efetiva (convertido para horas - HEF).

> **Exemplo Prático:** Utilizando o TDM de 300m anterior, se o tempo somado apenas com o bit no fundo cortando rocha foi de 5 horas, o ROP é de **60 m/h**. Este valor é comparado com o *benchmark* geológico para validar se o bit utilizado é o correto para aquela dureza de rocha.

### Taxa de Perfuração Bruta (Gross Drilling Rate - GDR)

Indica a produtividade global do ativo, considerando todo o tempo de ciclo ($X_i$), incluindo posicionamento, emboquilhamento, manobras de hastes e deslocamento. É o indicador de **eficiência logística** da operação.\
$$GDR = \frac{TDM}{\sum_{i=1}^{N(t)} X_i} \quad [m/h]$$

-   $X_i$: Soma das durações das fases 1 a 5 (Total Cycle Time).

::: {.callout-tip title="Análise de Performance: ROP vs. GDR"}
Um **GDR** muito inferior ao **ROP** indica que, embora a máquina perfure rápido, o processo de manobra, troca de hastes e deslocamento está retendo o ativo. Investigue o `Pct_Positioning` para diagnosticar se a oportunidade de melhoria está na perfuratriz ou na infraestrutura da frente.
:::

### Mensuração Automatizada com `drill_summarize_performance()`

O pacote `miningKPI` disponibiliza a função `drill_summarize_performance()`, que automatiza a aplicação dessas fórmulas. Como o dataset `drill_events_mine_d` utiliza *timestamps* (`exit_time`), criamos uma coluna temporal de agrupamento antes da sumarização.

```{r}
#| label: tbl-performance-report
#| tbl-cap: "Indicadores de Performance consolidados via drill_summarize_performance()"
#| echo: true
#| message: false

# 1. Preparação e Sumarização
# Chamada correta conforme a assinatura da função: per e time_unit
performance_summary <- drill_events_mine_d %>%
    add_missing_drill_phases() %>%
    drill_summarize_performance(
        per = drill_id,
        time_unit = "day"
    )

# 2. Exibição dos indicadores principais
# Nota: A função retorna a coluna 'periodo' (conforme o Passo 3 do código)
performance_summary %>%
    select(drill_id, periodo, TDM, WH, ROP, GDR, n_holes) %>%
    head(5) %>%
    knitr::kable(digits = 2)
```

### Análise de Performance: ROP vs. GDR (Performance Gap Analysis)

A robustez da análise gerencial reside no entendimento da diferença entre a velocidade de corte (**ROP**) e a velocidade de entrega do furo (**GDR**). Através do output acima, podemos realizar o diagnóstico técnico:

1.  **Rate of Penetration (ROP):** É o indicador de eficiência mecânica. Ele utiliza apenas as **HEF / EFH** (Horas Efetivas) no denominador. Se o ROP cair drasticamente entre um dia e outro na mesma frente, o gestor deve investigar o desgaste do bit ou uma mudança inesperada na dureza da litologia.

2.  **Gross Drilling Rate (GDR):** É o indicador de eficiência operacional/logística. Ele utiliza o **Xi** (Tempo Total de Ciclo) no denominador. Um GDR muito inferior ao ROP indica que, embora a máquina perfure rápido, o processo de manobra, troca de hastes e deslocamento está retendo o ativo.

3.  **Worked Hours (WH):** Corresponde ao tempo total que o equipamento passou executando o ciclo operacional ($X_i$). No pacote, este valor é derivado diretamente da soma das 5 fases fundamentais ($P_i + C_i + D_i + H_i + M_i$).

### Decomposição de Fases (Phase Breakdown)

Além das taxas de velocidade, a sumarização entrega a participação percentual de cada fase. No gráfico abaixo, podemos identificar visualmente o "ladrão de tempo" do ciclo:

```{r}
#| label: fig-fases-breakdown
#| fig-cap: "Participação percentual das fases no ciclo operacional"
#| echo: true

performance_summary %>%
    tidyr::pivot_longer(
        cols = starts_with("Pct_"),
        names_to = "fase",
        values_to = "percentual"
    ) %>%
    ggplot(aes(x = periodo, y = percentual, fill = fase)) +
    geom_area(alpha = 0.8) +
    scale_fill_viridis_d(option = "cividis") +
    theme_minimal() +
    labs(x = "Data (Período)", y = "Percentual do Ciclo", fill = "Fase")
```

### Interpretação Técnica da Decomposição de Fases

A @fig-fases-breakdown representa a **"dieta de tempo"** do ativo, permitindo uma auditoria visual de como o ciclo operacional $X_i$ é distribuído. Esta visualização é a tradução prática da Identidade Fundamental da Perfuração.

#### Estrutura dos Eixos e Composição

-   **Eixo Y (0.00 a 1.00):** Representa a normalização do Ciclo Operacional ($X_i$). Cada camada de cor indica a fração decimal (ou percentual) que uma fase específica consumiu do tempo total trabalhado.

-   **Eixo X (Temporal):** Mostra a evolução cronológica. A densidade de oscilações reflete a sensibilidade da telemetria em capturar as mudanças de estado da perfuratriz em tempo real.

#### Dinâmica das Camadas (Componentes do Ciclo)

-   **Pct_Drilling (Fase** $D_i$): É o componente central. Representa o tempo de perfuração efetiva (contato bit-rocha). Quando esta área é predominante, a operação está maximizando a utilização do motor de perfuração, e o **ROP (Rate of Penetration)** torna-se o principal driver de produtividade.

-   **Pct_Tramming (Fase** $M_i$): Representa o deslocamento entre furos. Picos volumosos nesta camada indicam malhas de perfuração muito dispersas ou dificuldades de navegação na bancada, o que degrada diretamente o **GDR (Gross Drilling Rate)**.

-   **Pct_Rods (Fase** $H_i$): Reflete o manuseio de hastes. Um aumento nesta área em furos de profundidade constante sugere fadiga mecânica no sistema de troca ou necessidade de reciclagem operacional.

-   **Pct_Collaring (Fase** $C_i$) e Pct_Positioning (Fase $P_i$): São as bases do ciclo. O crescimento da área cinza (`Positioning`) é o indicador mais fiel da qualidade da infraestrutura de mina: frentes mal niveladas exigem mais tempo para patolamento e estabilização das sapatas.

#### Diagnóstico de Variabilidade e Integridade

-   **Instabilidade Operacional:** O aspecto "serrilhado" do gráfico denuncia uma alta variabilidade nos processos de suporte. Note que a participação da perfuração efetiva oscila drasticamente, indicando que a rotina de trabalho ainda não atingiu um estado de controle estatístico.

-   **Lacunas de Dados (Data Gaps):** Os espaços em branco verticais (como observado no início de julho) são pontos de atenção para o analista de dados. Eles representam períodos sem registro de ciclo operacional, podendo indicar paradas de manutenção não reportadas ou falhas de conectividade da telemetria.

#### Insight para o Gestor: O Performance Gap

Este gráfico materializa a diferença entre a **capacidade mecânica** e a **eficiência logística**. Um erro comum na gestão de perfuração é focar apenas na velocidade do bit.

> **Conclusão de Mining Analytics:** A análise prova que perfurar rápido (**alto ROP**) não garante a entrega da meta se as fases acessórias não forem controladas. Nos dias em que a área de *Drilling* é "comprimida" por manobras e posicionamentos excessivos, a oportunidade de melhoria não está na perfuratriz, mas na preparação da frente de trabalho e na logística de suprimentos.

## Anonimização Espacial e Plano Cartesiano Local

Na análise de dados de mineração, a geolocalização bruta (coordenadas UTM ou Lat/Long) é considerada uma informação sensível. Para o desenvolvimento deste material, aplicamos uma técnica de **Translação de Origem**, convertendo as coordenadas globais em um **Plano Cartesiano Local**.

### O Conceito de Local Mine Grid

O processo consiste em identificar o ponto extremo Sudoeste (mínimo de X e Y) da base de dados e subtraí-lo de todos os demais registros. Matematicamente:

$$local\_x_i = GpsX_i - \min(GpsX)$$

$$local\_y_i = GpsY_i - \min(GpsY)$$

Esta abordagem garante três benefícios fundamentais para o analista de dados:

1.  **Anonimização Total:** A localização geográfica real da jazida é protegida.

2.  **Preservação Geométrica:** As distâncias entre os furos (Burdens e Spacings) permanecem em metros reais, permitindo cálculos de densidade de malha.

3.  **Simplicidade Computacional:** Trabalhar com valores de 0 a 5.000 é mais eficiente e menos propenso a erros de precisão do que manipular coordenadas na casa dos milhões.

::: {#exm-visualizacao-malha}
## Visualização da Malha de Perfuração

Através das variáveis `local_x` e `local_y`, podemos reconstruir a malha de perfuração para validar a execução do plano de fogo. No exemplo abaixo, visualizamos a distribuição espacial dos eventos de perfuração da **Mina D**:
:::

```{r}
#| label: fig-mapa-perfuracao
#| fig-cap: "Distribuição Espacial dos Furos (Plano Local Anonimizado)"
#| echo: true

library(ggplot2)

drill_events_mine_d %>%
    filter(drill_id == "DRILL_100") %>%
    ggplot(aes(x = local_x, y = local_y)) +
    geom_point(alpha = 0.4, size = 0.6, color = "#2c3e50") +
    coord_fixed() + # Garante que a escala X e Y seja 1:1 (metros reais)
    theme_minimal() +
    labs(
        title = "Spatial Distribution of Drill Holes",
        subtitle = "Anonymized Local Mine Grid",
        x = "Easting Local (m)",
        y = "Northing Local (m)"
    )
```

## Integração: Do Bit à Caçamba

Portanto, ao monitorarmos o **TDM** (Metragem Total Perfurada) e a aderência rigorosa à malha, estamos, na verdade, garantindo que a Identidade Fundamental do Carregamento, que exploraremos detalhadamente no \@ref(chap-carregamento), apresente os menores valores possíveis de variabilidade operacional.

Uma perfuração precisa é o alicerce para uma fragmentação homogênea. Esta, por sua vez, é o fator que maximiza o fator de enchimento da caçamba (*bucket fill factor*) e minimiza o tempo de ciclo das escavadeiras, fechando o elo de eficiência entre a perfuração e a carga.

## Agregação de Ciclos (Nível Borehole)

Nesta etapa final, elevamos o nível de granularidade da nossa análise para uma visão executiva. Enquanto o dataframe `drill_events_mine_d` foca em **eventos e fases** (cada micro-mudança de estado da perfuratriz), o dataframe `drill_cycles_mine_d` consolida esses dados para o nível de **ciclo de perfuração**, ou seja, o processo completo de um furo (*borehole*).

Esta agregação é fundamental para validar a **Identidade Fundamental da Perfuração** em larga escala, permitindo observar não apenas a produtividade, mas a qualidade da execução (profundidade real atingida vs. projetada).

::: {.callout-warning title="Exemplo de Validação: Desvios de Profundidade"}
Se o plano de fogo prevê furos de 12,0 m e a agregação no `drill_cycles_mine_d` demonstra uma média real de 10,5 m, temos um desvio de execução crítico. Este gap impactará diretamente na segurança operacional (risco de repés e sopeiras no piso) e elevará os custos unitários de detonação devido à má distribuição da carga de explosivos na coluna.
:::

## Exemplos Adicionais

::: {#exm-impacto-horas-improdutivas}
## Impacto nas Horas Improdutivas – Mina D

A performance global de uma frota de perfuração não é penalizada apenas pela dureza da rocha, mas significativamente pelo tempo em que as máquinas permanecem paralisadas, mesmo estando mecanicamente aptas para a operação. Através do pacote miningKPI, podemos filtrar e quantificar esses eventos. Abaixo, demonstramos como isolar os registros de ociosidade por Acerto de Praça para a perfuratriz DRILL_100:
:::

```{r}
#| echo: true
#| message: false

# Filtragem de eventos de ociosidade específicos: Aguardando Acerto de Praça
drill_events_mine_d %>%
    filter(
        drill_id == "DRILL_100",
        description %in% "Waiting for Pad Adjustment"
    ) %>%
    knitr::kable(caption = "Detalhamento de Eventos: Aguardando Acerto de Praça (DRILL_100)")
```

### Os "Ladrões de Tempo" no Ciclo de Perfuração

Na gestão de ativos mineiros, identificamos três categorias clássicas denominadas "ladrões de tempo". Estes eventos são fundamentais para explicar o *Performance Gap*: a discrepância entre a capacidade teórica de produção e o resultado real entregue no campo. No *Mining Analytics*, esses eventos são geralmente classificados como **Horas Ociosas Internas (IIH - Internal Idle Hours)**.

#### Ag Acerto de Praça (*Waiting for Pad Adjustment*)

O prefixo "Ag" denota **Aguardando**. A "praça" refere-se à bancada ou plataforma nivelada onde a perfuratriz deve se posicionar para operar.

-   **Definição Técnica:** Ocorre quando a perfuratriz está disponível, mas o terreno apresenta irregularidades, excesso de material solto (*toe*) ou furos remanescentes que impedem o patolamento seguro e o nivelamento das sapatas (*jacks*).

-   **Impacto no Analytics:** Este evento infla diretamente a fase de **Posicionamento (**$P_i$). A máquina permanece em espera até que um equipamento de suporte (Trator de Esteira ou Motoniveladora) realize a manutenção da área.

-   **Insight de Gestão:** Índices elevados nesta categoria revelam uma falha crítica na **frota de apoio e infraestrutura**. A oportunidade de melhoria não reside na operação da perfuratriz, mas na coordenação das atividades de suporte.

#### Troca de Turno (*Shift Change*)

Refere-se ao intervalo operacional necessário para a rendição das equipes de campo.

-   **Definição Técnica:** Compreende o tempo gasto no deslocamento dos operadores, inspeção visual do ativo (*Checklist*), Diálogo de Segurança (DSS) e a passagem de informações técnicas entre os turnos.

-   **Impacto no Analytics:** Embora seja um tempo planejado, a alta variabilidade na Troca de Turno degrada a **Utilização Física (UF)**. Em operações de classe mundial, busca-se a "Troca Quente" (rendição na cabine com motor ligado) para minimizar esse impacto.

-   **Insight de Gestão:** Monitorar a dispersão estatística desses tempos permite identificar ineficiências na logística de transporte de pessoal e na disciplina operacional das equipes.

#### Ag Topografia (*Waiting for Survey/Marking*)

A equipe de topografia é responsável por materializar o plano de fogo no terreno, indicando as coordenadas exatas de cada furo.

-   **Definição Técnica:** A perfuratriz está pronta, porém não há marcações físicas (piquetes ou tinta) ou liberação digital do polígono para execução.

-   **Impacto no Analytics:** Este evento representa uma falha de sincronismo entre o **Planejamento de Curto Prazo** e a execução. Dependendo da estrutura organizacional, pode ser tratado como restrição interna (IIH) ou externa (EIH).

-   **Insight de Gestão:** Em minas com alto nível de maturidade digital e sistemas de **HPGPS (High-Precision GPS)** embarcados, este tempo tende a zero, pois o projeto é transmitido via telemetria diretamente para o monitor do operador, eliminando a dependência de marcação física.
